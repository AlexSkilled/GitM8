CREATE TABLE IF NOT EXISTS tg_user
(
    id          INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name        TEXT,

    tg_username TEXT
);

CREATE TABLE IF NOT EXISTS gitlab_user
(
    name     TEXT,
    user_id  INTEGER REFERENCES tg_user (id),
    email    TEXT,
    token    TEXT,
    domain   TEXT
);

ALTER TABLE IF EXISTS gitlab_user
DROP CONSTRAINT IF EXISTS gitlab_PKs;

ALTER TABLE gitlab_user
ADD CONSTRAINT gitlab_PKs
UNIQUE (user_id, token, domain);

CREATE TABLE IF NOT EXISTS project
(
    id              INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name            TEXT,
    web_url         TEXT,
    repository_name TEXT
);

CREATE TABLE IF NOT EXISTS users_projects
(
    user_id    INTEGER REFERENCES tg_user (id),
    project_id INTEGER REFERENCES project (id)
)